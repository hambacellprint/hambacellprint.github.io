<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAMBA CELL & PRINT ‚Äî Member App</title>
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body,
        html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background: #ffffff;
            font-family: 'Segoe UI', Inter, sans-serif;
        }

        /* ===== IFRAME ===== */
        #app-frame {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ===== OVERLAY ===== */
        #overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #060b24, #1a0308, #0c1a3d);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            transition: opacity 0.7s ease;
        }

        #overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .ov-logo {
            font-size: 3rem;
            line-height: 1;
        }

        .ov-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: #ffffff;
            text-align: center;
            letter-spacing: 0.02em;
        }

        .ov-sub {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
        }

        /* ===== PROGRESS BAR ===== */
        .progress-wrap {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            border-radius: 999px;
            background: linear-gradient(90deg, #4f46e5, #6366f1);
            transition: width 0.4s ease;
        }

        .ov-status {
            font-size: 0.78rem;
            color: rgba(255, 255, 255, 0.55);
            text-align: center;
            min-height: 18px;
        }

        /* ===== ERROR STATE ===== */
        #error-box {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 14px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 24px 28px;
            text-align: center;
            max-width: 300px;
        }

        .err-icon {
            font-size: 2.2rem;
        }

        .err-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: #fca5a5;
        }

        .err-msg {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.45);
            line-height: 1.5;
        }

        .btn-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-retry,
        .btn-open {
            padding: 9px 20px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: opacity 0.2s;
        }

        .btn-retry:hover,
        .btn-open:hover {
            opacity: 0.85;
        }

        .btn-retry {
            background: linear-gradient(135deg, #4f46e5, #3730a3);
            color: white;
        }

        .btn-open {
            background: rgba(255, 255, 255, 0.12);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.25);
        }
    </style>
</head>

<body>

    <!-- Overlay Loading -->
    <div id="overlay">
        <div class="ov-logo">üì±</div>
        <div>
            <div class="ov-title">HAMBA CELL & PRINT</div>
            <div class="ov-sub">KONTER DAN PERCETAKAN ‚Äî Member App</div>
            <div class="ov-sub" style="font-size:0.68rem;margin-top:2px">PULSA ¬∑ DATA ¬∑ SERVISE HP ¬∑ HP BARU ¬∑ ATM BERSAMA ¬∑ PRINT ¬∑ FOTO DLL.</div>
        </div>
        <div class="progress-wrap">
            <div class="progress-bar" id="prog"></div>
        </div>
        <div class="ov-status" id="status-text">Menyiapkan aplikasi...</div>

        <!-- Error box (tersembunyi, muncul jika timeout 18 detik) -->
        <div id="error-box">
            <div class="err-icon">‚ö†Ô∏è</div>
            <div class="err-title">Gagal memuat aplikasi</div>
            <div class="err-msg">Server lambat atau koneksi bermasalah.<br>Coba lagi atau buka langsung di tab baru.
            </div>
            <div class="btn-row">
                <button class="btn-retry" onclick="retryLoad()">üîÑ Coba Lagi</button>
                <button class="btn-open" onclick="openDirect()">‚Üó Buka Langsung</button>
            </div>
        </div>
    </div>

    <!-- Iframe GAS -->
    <iframe id="app-frame"
        src="https://script.google.com/macros/s/AKfycbzuDjy28Yy6vBextKZkbPUoLw4-1c4vjzEYnL4eJfAPKAxmfgglssx8tne_FsXVbLqz/exec"
        allow="geolocation; microphone; camera; clipboard-read; clipboard-write; encrypted-media;"></iframe>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzuDjy28Yy6vBextKZkbPUoLw4-1c4vjzEYnL4eJfAPKAxmfgglssx8tne_FsXVbLqz/exec";

        const iframe = document.getElementById('app-frame');
        const overlay = document.getElementById('overlay');
        const prog = document.getElementById('prog');
        const statusTxt = document.getElementById('status-text');
        const errorBox = document.getElementById('error-box');

        let loaded = false;
        let progVal = 0;
        let progTimer, errorTimer;

        // Simulasi progress bar ‚Äî melambat di 92%, tunggu onload
        function startProgress() {
            progVal = 0;
            clearInterval(progTimer);
            progTimer = setInterval(() => {
                if (loaded) { clearInterval(progTimer); return; }
                const inc = progVal < 40 ? 3 : progVal < 70 ? 1.5 : progVal < 92 ? 0.4 : 0;
                progVal = Math.min(progVal + inc, 92);
                prog.style.width = progVal + '%';
            }, 200);
        }

        // Update teks status berdasarkan progres
        function updateStatusMsg() {
            if (loaded) return;
            if (progVal < 30) statusTxt.textContent = 'Menyiapkan aplikasi...';
            else if (progVal < 60) statusTxt.textContent = 'Menghubungi server...';
            else if (progVal < 85) statusTxt.textContent = 'Memuat data...';
            else statusTxt.textContent = 'Hampir siap...';
        }
        setInterval(updateStatusMsg, 800);

        // Sembunyikan overlay setelah iframe loaded
        function hideOverlay() {
            loaded = true;
            clearInterval(progTimer);
            clearTimeout(errorTimer);
            prog.style.width = '100%';
            statusTxt.textContent = 'Siap!';
            setTimeout(() => {
                overlay.classList.add('fade-out');
                setTimeout(() => { overlay.style.display = 'none'; }, 700);
            }, 400);
        }

        // Tampilkan error jika timeout 18 detik
        function showError() {
            if (loaded) return;
            clearInterval(progTimer);
            statusTxt.style.display = 'none';
            prog.parentElement.style.display = 'none';
            errorBox.style.display = 'flex';
        }

        // Tombol Coba Lagi ‚Äî reload iframe dengan cache buster
        function retryLoad() {
            errorBox.style.display = 'none';
            statusTxt.style.display = 'block';
            prog.parentElement.style.display = 'block';
            statusTxt.textContent = 'Mencoba kembali...';
            loaded = false;
            iframe.src = GAS_URL + '?_t=' + Date.now();
            startProgress();
            errorTimer = setTimeout(showError, 18000);
        }

        // Tombol Buka Langsung di tab baru
        function openDirect() {
            window.open(GAS_URL, '_blank');
        }

        // Init
        iframe.onload = hideOverlay;
        errorTimer = setTimeout(showError, 18000);
        startProgress();
    </script>
</body>

</html>
